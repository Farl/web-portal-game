<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Portal Prototype</title>
  <script type="importmap">
  {
    "imports": {
      "three": "https://esm.sh/three@0.158.0",
      "three/examples/jsm/controls/PointerLockControls.js": "https://esm.sh/three@0.158.0/examples/jsm/controls/PointerLockControls.js",
      "three/examples/jsm/controls/OrbitControls.js": "https://esm.sh/three@0.158.0/examples/jsm/controls/OrbitControls.js",
      "three/examples/jsm/controls/TransformControls.js": "https://esm.sh/three@0.158.0/examples/jsm/controls/TransformControls.js",
      "nipplejs": "https://esm.sh/nipplejs@0.9.0"
    }
  }
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <canvas id="webgl" tabindex="0"></canvas>

  <!-- Start Menu -->
  <div id="start-menu" class="menu-overlay">
    <div class="menu-panel">
      <h1>Project Aperture</h1>
      <p class="subtitle">Simple Portal Prototype</p>
      <div class="menu-buttons">
        <button id="btn-play-mode" class="menu-btn primary">
          <span class="btn-icon">üéÆ</span>
          <span class="btn-text">Play</span>
          <span class="btn-desc"></span>
        </button>
        <button id="btn-edit-mode" class="menu-btn desktop-only">
          <span class="btn-icon">üõ†Ô∏è</span>
          <span class="btn-text">Editor</span>
          <span class="btn-desc">(3 save slots with auto-save)</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Mode UI -->
  <div id="edit-ui" class="hidden">
    <!-- Top Toolbar with Back Button and Tools -->
    <div class="edit-topbar">
      <button id="btn-exit-edit" class="icon-btn" title="Back to Menu">‚óÑ</button>
      <div class="topbar-divider"></div>
      <div class="icon-buttons">
        <button class="icon-btn" data-mode="select" title="Select (Q)"><i
            class="fa-solid fa-hand-pointer"></i></button>
        <button class="icon-btn active" data-mode="translate" title="Move (W)"><i
            class="fa-solid fa-up-down-left-right"></i></button>
        <button class="icon-btn" data-mode="rotate" title="Rotate (E)"><i class="fa-solid fa-rotate"></i></button>
        <button class="icon-btn" data-mode="scale" title="Scale (R)"><i
            class="fa-solid fa-up-right-and-down-left-from-center"></i></button>
        <button id="btn-delete" class="icon-btn danger" title="Delete (Del)"><i
            class="fa-solid fa-trash"></i></button>
      </div>
    </div>

    <!-- Place Objects Panel (Left Side, Always Visible) -->
    <div id="place-objects-panel">
      <div class="panel-header">
        <h4>Place Objects</h4>
      </div>

      <!-- Portalable Objects Group -->
      <div class="place-group">
        <button class="place-text-btn" id="btn-place-wall" data-type="wall">Wall</button>
        <button class="place-text-btn" id="btn-place-platform" data-type="platform">Platform</button>

        <!-- Modern Toggle Switch -->
        <div class="toggle-container">
          <span class="toggle-label">Portalable</span>
          <label class="toggle-switch">
            <input type="checkbox" id="portalable-checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <!-- Other Objects -->
      <div class="place-group">
        <button class="place-text-btn" id="btn-place-glass-wall" data-type="glass-wall">Glass Wall</button>
        <button class="place-text-btn" id="btn-place-cube" data-type="cube">Cube</button>
        <button class="place-text-btn" id="btn-place-goal" data-type="goal">Door</button>
        <button class="place-text-btn" id="btn-place-spawner" data-type="spawner">Player Spawner</button>
      </div>
    </div>

    <!-- Level Slot Selector (Top Right) -->
    <div id="level-slot-selector">
      <div class="slot-label">Slot:</div>
      <div class="slot-buttons">
        <button class="slot-btn" data-slot="1" title="Slot 1 (Key: 1)">1</button>
        <button class="slot-btn" data-slot="2" title="Slot 2 (Key: 2)">2</button>
        <button class="slot-btn" data-slot="3" title="Slot 3 (Key: 3)">3</button>
      </div>
      <button id="btn-reset-level" class="slot-reset-btn" title="Reset to Default">
        <i class="fa-solid fa-rotate-left"></i>
      </button>
    </div>

    <!-- Editor Controls Panel (Bottom Right, Compact) -->
    <div id="editor-controls-panel">
      <button id="controls-toggle-btn" class="controls-toggle" title="Toggle Controls">
        <i class="fa-solid fa-keyboard"></i>
      </button>
      <div id="controls-content" class="controls-content">
        <div class="controls-header">
          <h4>Keys</h4>
        </div>
        <div class="controls-list">
          <div class="control-item">
            <span class="control-key">RMB+WASD</span>
            <span class="control-desc">Move</span>
          </div>
          <div class="control-item">
            <span class="control-key">RMB+Mouse</span>
            <span class="control-desc">Look</span>
          </div>
          <div class="control-item">
            <span class="control-key">Space/Shift</span>
            <span class="control-desc">Up/Down</span>
          </div>
          <div class="control-item">
            <span class="control-key">Q/W/E/R</span>
            <span class="control-desc">Tools</span>
          </div>
          <div class="control-item">
            <span class="control-key">1/2/3</span>
            <span class="control-desc">Slot</span>
          </div>
          <div class="control-item">
            <span class="control-key">ESC</span>
            <span class="control-desc">Cancel</span>
          </div>
          <div class="control-item">
            <span class="control-key">Del</span>
            <span class="control-desc">Delete</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="ui">
    <div id="crosshair"></div>
    <div id="click-to-play" class="hidden">Click to Play</div>
    <div id="hint">Click to lock mouse. LMB: Blue portal, RMB: Orange portal. E: Grab/Throw cube.</div>
    <div id="mobile-controls">
      <div id="left-joystick"></div>
      <div id="right-joystick"></div>
      <div id="mobile-buttons">
        <button id="btn-blue" aria-label="Blue portal">üîµ</button>
        <button id="btn-orange" aria-label="Orange portal">üü†</button>
        <button id="btn-grab" aria-label="Grab/Throw">üëä</button>
      </div>
    </div>
    <div id="level-complete" class="hidden">
      <div class="panel">
        <h2>Level Complete</h2>
        <p>You reached the goal.</p>
        <p id="time-elapsed">Time: 0.00s</p>
        <button id="retry-btn">Retry Level</button>
      </div>
    </div>
    <div id="throw-gauge">
      <div id="throw-bar"></div>
      <span id="throw-value">0 m/s</span>
    </div>
    <div id="render-scale-control" style="display: none;">
      <label for="render-scale">Render scale</label>
      <input id="render-scale" type="range" min="0.25" max="1" step="0.05" value="1">
      <span id="render-scale-label">100%</span>
    </div>
    <button id="back-to-menu" style="display: none;" aria-label="Back to menu">‚óÑ</button>
    <button id="menu-toggle" aria-label="Toggle settings">‚ò∞</button>
  </div>
  <div id="debug-ui" style="display: none;">
    <h3>Stencil Test</h3>
    <label><input type="checkbox" id="stepA"> Step A: Draw stencil mask (quad)</label><br>
    <label><input type="checkbox" id="stepB"> Step B: Draw sphere (only visible where stencil=1)</label><br>
    <hr>
    <h3>Portal Rendering</h3>
    <label><input type="checkbox" id="step0" checked> Step 0: Blue Portal Mask</label><br>
    <label><input type="checkbox" id="step1" checked> Step 1: Blue Portal View</label><br>
    <label><input type="checkbox" id="step2" checked> Step 2: Orange Portal Mask</label><br>
    <label><input type="checkbox" id="step3" checked> Step 3: Orange Portal View</label><br>
    <label><input type="checkbox" id="step4" checked> Step 4: Main Scene</label><br>
    <label><input type="checkbox" id="step5" checked> Step 5: Portal Borders</label><br>
    <label><input type="checkbox" id="step6" checked> Step 6: Transparent Objects</label><br>
  </div>
  <script type="module" src="./main.js"></script>
</body>

</html>